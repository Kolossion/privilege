// Generated by CoffeeScript 1.10.0
(function() {
  var authHandlerFactory, empower, parseOptions;

  parseOptions = require('./options');

  authHandlerFactory = function(roleMap, token, method, done) {
    return function(err, roles) {
      if (err) {
        return done(err);
      } else {
        return done(null, roleMap.check(roles, token, method));
      }
    };
  };

  empower = function(options, ctx, path, method, done) {
    var contextToRoles, e, error, pathMap, pathToken, ref, roleMap;
    try {
      ref = parseOptions(options), contextToRoles = ref.contextToRoles, roleMap = ref.roleMap, pathMap = ref.pathMap;
      pathToken = pathMap.getToken(path);
      return contextToRoles(ctx, authHandlerFactory(roleMap, pathToken, method, done));
    } catch (error) {
      e = error;
      return done(e);
    }
  };

  empower.authHandlerFactory = authHandlerFactory;

  module.exports = empower;

}).call(this);
